<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArxivScribe</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <header>
        <div class="header-left">
            <h1>ArxivScribe</h1>
            <span class="subtitle">AI-powered arXiv paper digests</span>
        </div>
        <div class="header-right">
            <div class="stats">
                <span>Papers: <span id="stat-papers">{{ stats.total_papers }}</span></span>
                <span>Keywords: <span id="stat-subs">{{ stats.total_subscriptions }}</span></span>
            </div>
            <button id="btn-theme" class="icon-btn" title="Toggle theme">&#127769;</button>
        </div>
    </header>

    <nav class="tab-bar">
        <button class="tab active" data-tab="feed">Feed</button>
        <button class="tab" data-tab="bookmarks">Bookmarks</button>
        <button class="tab" data-tab="search">Search</button>
        <button class="tab" data-tab="digests">Email Digests</button>
    </nav>

    <main>
        <!-- FEED TAB -->
        <div id="tab-feed" class="tab-content active">
            <section class="controls">
                <div class="control-group">
                    <h3>Keywords</h3>
                    <div class="keyword-input">
                        <input type="text" id="keyword-input" placeholder="e.g. transformer, RLHF" />
                        <button id="btn-subscribe" class="btn btn-primary">+ Add</button>
                    </div>
                    <div id="keyword-tags" class="tags">
                        {% for kw in subscriptions %}
                        <span class="tag">{{ kw }} <button class="tag-remove" data-keyword="{{ kw }}">&times;</button></span>
                        {% endfor %}
                    </div>
                </div>
                <div class="control-group">
                    <h3>Fetch</h3>
                    <div class="action-buttons">
                        <button id="btn-fetch" class="btn btn-accent">Fetch Papers</button>
                        <button id="btn-fetch-all" class="btn btn-secondary">Fetch All (no filter)</button>
                    </div>
                </div>
                <div class="control-group">
                    <h3>Export</h3>
                    <div class="action-buttons">
                        <select id="export-format" class="select-input">
                            <option value="bibtex">BibTeX</option>
                            <option value="markdown">Markdown</option>
                            <option value="csv">CSV</option>
                            <option value="json">JSON</option>
                        </select>
                        <button id="btn-export" class="btn btn-secondary">Download</button>
                    </div>
                </div>
            </section>

            <div id="status-bar" class="status-bar hidden"></div>

            <!-- Filters bar -->
            <section class="filters-bar">
                <div class="filter-group">
                    <label>Sort:</label>
                    <select id="sort-select" class="select-sm">
                        <option value="date">Date</option>
                        <option value="votes">Votes</option>
                        <option value="title">Title</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>From:</label>
                    <input type="date" id="date-from" class="input-sm" />
                </div>
                <div class="filter-group">
                    <label>To:</label>
                    <input type="date" id="date-to" class="input-sm" />
                </div>
                <div class="filter-group">
                    <label>Category:</label>
                    <select id="cat-filter" class="select-sm">
                        <option value="">All</option>
                        {% for cat in distinct_categories %}
                        <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-group">
                    <input type="text" id="filter-input" placeholder="Search text..." class="input-sm" />
                </div>
                <div class="filter-group">
                    <select id="per-page-select" class="select-sm">
                        <option value="10">10/pg</option>
                        <option value="20" selected>20/pg</option>
                        <option value="50">50/pg</option>
                    </select>
                </div>
                <span class="paper-count"><span id="paper-count">{{ papers|length }}</span> papers</span>
            </section>

            <section id="papers" class="papers">
                {% for paper in papers %}
                {% include "paper_card.html" %}
                {% endfor %}
            </section>

            <!-- Pagination -->
            <section id="pagination" class="pagination">
                <button id="pg-prev" class="btn btn-secondary pg-btn" disabled>&laquo; Prev</button>
                <span id="pg-info" class="pg-info">Page 1</span>
                <button id="pg-next" class="btn btn-secondary pg-btn">Next &raquo;</button>
            </section>
        </div>

        <!-- BOOKMARKS TAB -->
        <div id="tab-bookmarks" class="tab-content">
            <section class="bookmarks-header">
                <h2>Reading List</h2>
                <div class="collections-bar" id="collections-bar">
                    {% for col in collections %}
                    <button class="collection-btn" data-collection="{{ col.name }}">{{ col.name }} ({{ col.count }})</button>
                    {% endfor %}
                </div>
                <button id="btn-export-bookmarks" class="btn btn-secondary">Export Bookmarks</button>
            </section>
            <section id="bookmarks-list" class="papers"></section>
        </div>

        <!-- SEARCH TAB -->
        <div id="tab-search" class="tab-content">
            <section class="search-section">
                <div class="keyword-input search-wide">
                    <input type="text" id="search-input" placeholder="Search arXiv (e.g. 'multi-agent reinforcement learning')..." />
                    <button id="btn-search" class="btn btn-primary">Search</button>
                </div>
            </section>
            <section id="search-results" class="papers"></section>
        </div>

        <!-- DIGESTS TAB -->
        <div id="tab-digests" class="tab-content">
            <section class="digest-setup">
                <h2>Email Digest Setup</h2>
                <p class="text-muted">Get a daily or weekly email with new papers matching your interests.</p>

                <div class="digest-form">
                    <div class="form-row">
                        <label>Email:</label>
                        <input type="email" id="digest-email" placeholder="you@example.com" class="input-md" />
                    </div>
                    <div class="form-row">
                        <label>Keywords:</label>
                        <input type="text" id="digest-keywords" placeholder="transformer, attention (comma-separated)" class="input-md" />
                    </div>
                    <div class="form-row">
                        <label>Categories:</label>
                        <input type="text" id="digest-categories" placeholder="cs.LG, cs.AI (or leave blank for all)" class="input-md" />
                    </div>
                    <div class="form-row">
                        <label>Schedule:</label>
                        <select id="digest-schedule" class="select-input">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label>Send at (UTC):</label>
                        <input type="number" id="digest-hour" value="9" min="0" max="23" class="input-sm" style="width:60px" />
                        <span class="text-muted">:00</span>
                    </div>
                    <div class="form-row">
                        <button id="btn-create-digest" class="btn btn-accent">Create Digest</button>
                        <button id="btn-test-digest" class="btn btn-secondary">Send Test Email</button>
                    </div>
                </div>

                {% if not smtp_configured %}
                <div class="notice">
                    To send emails, add to your <code>.env</code>:<br>
                    <code>SMTP_USER=your@gmail.com</code><br>
                    <code>SMTP_PASS=your-app-password</code><br>
                    <small>(For Gmail, use an <a href="https://myaccount.google.com/apppasswords" target="_blank">App Password</a>)</small>
                </div>
                {% endif %}

                <h3 style="margin-top:24px;">Active Digests</h3>
                <div id="digest-list"></div>
            </section>
        </div>

        <div id="loading" class="loading hidden">
            <div class="spinner"></div><span>Loading...</span>
        </div>

        <div id="empty-state" class="empty-state {% if papers %}hidden{% endif %}">
            <p>No papers yet</p>
            <p>Add some keywords and click <strong>Fetch Papers</strong> to get started.</p>
        </div>
    </main>

    <!-- Similar papers modal -->
    <div id="similar-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Similar Papers</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div id="similar-papers" class="papers"></div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
